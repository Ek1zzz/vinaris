<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ â€” VINaris</title>
  <style>
    :root{
      --bg:#0b0b0d; --bg-soft:#121216; --card:#15151b;
      --text:#e8e8ee; --muted:#a6a6b3; --primary:#e11d2e;
      --primary-600:#c21827; --border:#23232b; --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px; --radius-lg:24px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; flex-direction:column;
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial;
      background: radial-gradient(1200px 600px at 80% -10%, rgba(225,29,46,.12), transparent 60%), var(--bg);
      color:var(--text);
    }
    header{
      backdrop-filter:saturate(180%) blur(10px);
      background: linear-gradient(180deg, rgba(11,11,13,.9), rgba(11,11,13,.6));
      border-bottom:1px solid var(--border);
      padding:.8rem 1rem; display:flex; align-items:center; justify-content:space-between;
    }
    .brand{display:flex; align-items:center; gap:.6rem; color:var(--text); font-weight:800; text-decoration:none}
    .logo{
      width:32px; aspect-ratio:1; border-radius:10px; display:grid; place-items:center; font-weight:800;
      background: radial-gradient(circle at 30% 20%, #ff4d5e, #7a0f17); color:white;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
      padding:.5rem 1rem; border-radius:12px; background:var(--primary); color:white; font-weight:600;
      transition:.2s; border:1px solid rgba(255,255,255,.06);
    }
    .btn.secondary{background:#1f1f26; border:1px solid var(--border); color:var(--text)}
    .btn.secondary:hover{background:#24242c}
    .btn:hover{background:var(--primary-600)}
    main{flex:1; display:flex; align-items:center; justify-content:center; padding:2rem}
    .auth-card{
      width:min(400px,92%); padding:32px; border-radius:var(--radius-lg);
      background:var(--card); border:1px solid var(--border); box-shadow:var(--shadow);
    }
    .auth-card h2{text-align:center; margin:0 0 18px}
    .auth-card label{display:block; margin:10px 0 6px; font-weight:600}
    .auth-card input{
      width:100%; padding:.9rem 1rem; border-radius:12px;
      border:1px solid var(--border); background:#0f0f14; color:var(--text);
    }
    .actions{margin-top:18px; display:flex; flex-direction:column; gap:10px}
    .muted{text-align:center; margin-top:12px; color:var(--muted)}
    a{color:var(--primary); text-decoration:none}
    .input-wrap{position:relative}
    .toggle-pass{position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; color:var(--muted); cursor:pointer}
    .error{color:#f87171; font-size:.85rem; margin-top:6px; display:none}
    footer{padding:24px 0; border-top:1px solid var(--border); color:#b8b8c6; text-align:center; font-size:.9rem}
  </style>
</head>
<body>
  <header>
    <a href="../index.html" class="brand">
      <div class="logo">V</div><span>VINaris</span>
    </a>
    <a href="../index.html" class="btn secondary">â† áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜</a>
  </header>

  <main>
    <div class="auth-card">
      <h2>áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</h2>
      <form id="loginForm">
        <label>áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ</label>
        <input type="email" id="loginEmail" placeholder="you@example.com" />
        <label>áƒáƒáƒ áƒáƒšáƒ˜</label>
        <div class="input-wrap">
          <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          <button type="button" class="toggle-pass" onclick="togglePass('loginPass')">ğŸ‘ï¸</button>
        </div>
        <p class="error" id="loginError">áƒ’áƒ—áƒ®áƒáƒ• áƒ¨áƒ”áƒáƒ•áƒ¡áƒ áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜</p>
        <div class="actions">
          <button class="btn" type="submit">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
          <a href="register.html" class="btn secondary">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</a>
        </div>
      </form>
      <p class="muted"><a href="#">áƒ“áƒáƒ’áƒáƒ•áƒ˜áƒ¬áƒ§áƒ“áƒ áƒáƒáƒ áƒáƒšáƒ˜?</a></p>
    </div>
  </main>

  <footer>
    Â© <span id="year"></span> VINaris. áƒ§áƒ•áƒ”áƒšáƒ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒ“áƒáƒªáƒ£áƒšáƒ˜áƒ.
  </footer>

<script src="../js/xampp-api-utils.js"></script>
<script>
document.getElementById("year").textContent = new Date().getFullYear();

function togglePass(id){
  const input=document.getElementById(id);
  input.type = input.type==="password" ? "text" : "password";
}

// Check if already logged in
if (EnhancedAuth.isLoggedIn()) {
  const user = EnhancedAuth.getCurrentUser();
  const redirectPath = user.type === 'admin' ? '../Adminpanel/enhanced-admin-panel-fixed.html' : '../Userpanel/enhanced-user-panel.html';
  window.location.href = redirectPath;
}

document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const email = document.getElementById("loginEmail").value.trim();
  const pass = document.getElementById("loginPass").value.trim();
  const err = document.getElementById("loginError");
  const submitBtn = e.target.querySelector('button[type="submit"]');
  
  // Enhanced validation
  if(!email || !pass){
    err.style.display="block";
    err.textContent = "áƒ’áƒ—áƒ®áƒáƒ• áƒ¨áƒ”áƒáƒ•áƒ¡áƒ áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜";
    return;
  }
  
  // Email format validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    err.style.display="block";
    err.textContent = "áƒ’áƒ—áƒ®áƒáƒ• áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ áƒ¡áƒ¬áƒáƒ áƒ˜ áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜";
    return;
  }
  
  // Password length validation
  if (pass.length < 6) {
    err.style.display="block";
    err.textContent = "áƒáƒáƒ áƒáƒšáƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ›áƒ˜áƒœáƒ˜áƒ›áƒ£áƒ› 6 áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ";
    return;
  }
  
  err.style.display="none";
  submitBtn.innerHTML = 'â³ áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ...';
  submitBtn.disabled = true;
  
  try {
    EnhancedUI.showLoading('áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜...');
    
    const user = await EnhancedAuth.login(email, pass);
    
    EnhancedUI.hideLoading();
    submitBtn.innerHTML = 'âœ… áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ';
    
    // Redirect based on user type with correct paths
    setTimeout(() => {
      if (user.type === 'admin') {
        window.location.href = '../Adminpanel/enhanced-admin-panel-fixed.html';
      } else {
        window.location.href = '../Userpanel/enhanced-user-panel.html';
      }
    }, 1000);
    
  } catch (error) {
    EnhancedUI.hideLoading();
    submitBtn.innerHTML = 'áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ';
    submitBtn.disabled = false;
    err.style.display="block";
    
    // Better error message handling
    let errorMessage = error.message;
    if (error.message.includes('Failed to fetch')) {
      errorMessage = 'áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ. áƒ’áƒ—áƒ®áƒáƒ• áƒ¡áƒªáƒáƒ“áƒ áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ.';
    } else if (error.message.includes('Invalid credentials')) {
      errorMessage = 'áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ áƒáƒœ áƒáƒáƒ áƒáƒšáƒ˜ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜áƒ';
    } else if (error.message.includes('Invalid email format')) {
      errorMessage = 'áƒ’áƒ—áƒ®áƒáƒ• áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ áƒ¡áƒ¬áƒáƒ áƒ˜ áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜';
    }
    
    err.textContent = errorMessage;
    console.error('Login error:', error);
  }
});

// Demo login info
const demoInfo = document.createElement('div');
demoInfo.innerHTML = `
  <div style="margin-top: 16px; padding: 12px; background: #1a1a1a; border: 1px solid var(--border); border-radius: 8px; font-size: 0.85rem; color: var(--muted);">
    <strong>áƒ“áƒ”áƒ›áƒ áƒ áƒ”áƒŸáƒ˜áƒ›áƒ˜:</strong><br>
    ğŸ‘¤ áƒ áƒ”áƒ’áƒ£áƒšáƒáƒ áƒ£áƒšáƒ˜: áƒœáƒ”áƒ‘áƒ˜áƒ¡áƒ›áƒ˜áƒ”áƒ áƒ˜ áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ + áƒáƒáƒ áƒáƒšáƒ˜<br>
    ğŸ‘¨â€ğŸ’¼ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ˜: admin@vinaris.ge / admin123
  </div>
`;
document.querySelector('.auth-card').appendChild(demoInfo);
</script>
</body>
</html>
